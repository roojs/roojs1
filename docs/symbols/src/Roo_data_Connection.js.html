<html><head><title>../roojs1/Roo/data/Connection.js</title><link rel="stylesheet" type="text/css" href="../../../css/highlight-js.css"/></head><body class="highlightpage"><code class="jsdoc-pretty"><span class="jsdoc-comment">/*
 * Based on:
 * Ext JS Library 1.1.1
 * Copyright(c) 2006-2007, Ext JS, LLC.
 *
 * Originally Released Under LGPL - original licence link has changed is not relivant.
 *
 * Fork - LGPL
 * &lt;script type=&quot;text/javascript&quot;&gt;
 */

 

/**
 * @class Roo.data.Connection
 * @extends Roo.util.Observable
 * The class encapsulates a connection to the page's originating domain, allowing requests to be made
 * either to a configured URL, or to a URL specified at request time.&lt;br&gt;&lt;br&gt;
 * &lt;p&gt;
 * Requests made by this class are asynchronous, and will return immediately. No data from
 * the server will be available to the statement immediately following the {@link #request} call.
 * To process returned data, use a callback in the request options object, or an event listener.&lt;/p&gt;&lt;br&gt;
 * &lt;p&gt;
 * Note: If you are doing a file upload, you will not get a normal response object sent back to
 * your callback or event handler.  Since the upload is handled via in IFRAME, there is no XMLHttpRequest.
 * The response object is created using the innerHTML of the IFRAME's document as the responseText
 * property and, if present, the IFRAME's XML document as the responseXML property.&lt;/p&gt;&lt;br&gt;
 * This means that a valid XML or HTML document must be returned. If JSON data is required, it is suggested
 * that it be placed either inside a &amp;lt;textarea&gt; in an HTML document and retrieved from the responseText
 * using a regex, or inside a CDATA section in an XML document and retrieved from the responseXML using
 * standard DOM methods.
 * @constructor
 * @param {Object} config a configuration object.
 */
</span><span class="jsdoc-var">Roo.data.Connection </span><span class="jsdoc-syntax">= </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">config</span><span class="jsdoc-syntax">){
    </span><span class="jsdoc-var">Roo.apply</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">config</span><span class="jsdoc-syntax">);
    </span><span class="jsdoc-var">this.addEvents</span><span class="jsdoc-syntax">({
        </span><span class="jsdoc-comment">/**
         * @event beforerequest
         * Fires before a network request is made to retrieve a data object.
         * @param {Connection} conn This Connection object.
         * @param {Object} options The options config object passed to the {@link #request} method.
         */
        </span><span class="jsdoc-string">&quot;beforerequest&quot; </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">,
        </span><span class="jsdoc-comment">/**
         * @event requestcomplete
         * Fires if the request was successfully completed.
         * @param {Connection} conn This Connection object.
         * @param {Object} response The XHR object containing the response data.
         * See {@link http://www.w3.org/TR/XMLHttpRequest/} for details.
         * @param {Object} options The options config object passed to the {@link #request} method.
         */
        </span><span class="jsdoc-string">&quot;requestcomplete&quot; </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">,
        </span><span class="jsdoc-comment">/**
         * @event requestexception
         * Fires if an error HTTP status was returned from the server.
         * See {@link http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html} for details of HTTP status codes.
         * @param {Connection} conn This Connection object.
         * @param {Object} response The XHR object containing the response data.
         * See {@link http://www.w3.org/TR/XMLHttpRequest/} for details.
         * @param {Object} options The options config object passed to the {@link #request} method.
         */
        </span><span class="jsdoc-string">&quot;requestexception&quot; </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">true
    </span><span class="jsdoc-syntax">});
    </span><span class="jsdoc-var">Roo.data.Connection.superclass.constructor.call</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">);
};

</span><span class="jsdoc-var">Roo.extend</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">Roo.data.Connection</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">Roo.util.Observable</span><span class="jsdoc-syntax">, {
    </span><span class="jsdoc-comment">/**
     * @cfg {String} url (Optional) The default URL to be used for requests to the server. (defaults to undefined)
     */
    /**
     * @cfg {Object} extraParams (Optional) An object containing properties which are used as
     * extra parameters to each request made by this object. (defaults to undefined)
     */
    /**
     * @cfg {Object} defaultHeaders (Optional) An object containing request headers which are added
     *  to each request made by this object. (defaults to undefined)
     */
    /**
     * @cfg {String} method (Optional) The default HTTP method to be used for requests. (defaults to undefined; if not set but parms are present will use POST, otherwise GET)
     */
    /**
     * @cfg {Number} timeout (Optional) The timeout in milliseconds to be used for requests. (defaults to 30000)
     */
    </span><span class="jsdoc-var">timeout </span><span class="jsdoc-syntax">: 30000,
    </span><span class="jsdoc-comment">/**
     * @cfg {Boolean} autoAbort (Optional) Whether this request should abort any pending requests. (defaults to false)
     * @type Boolean
     */
    </span><span class="jsdoc-var">autoAbort</span><span class="jsdoc-syntax">:</span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">,

    </span><span class="jsdoc-comment">/**
     * @cfg {Boolean} disableCaching (Optional) True to add a unique cache-buster param to GET requests. (defaults to true)
     * @type Boolean
     */
    </span><span class="jsdoc-var">disableCaching</span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">,

    </span><span class="jsdoc-comment">/**
     * Sends an HTTP request to a remote server.
     * @param {Object} options An object which may contain the following properties:&lt;ul&gt;
     * &lt;li&gt;&lt;b&gt;url&lt;/b&gt; {String} (Optional) The URL to which to send the request. Defaults to configured URL&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;params&lt;/b&gt; {Object/String/Function} (Optional) An object containing properties which are used as parameters to the
     * request, a url encoded string or a function to call to get either.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;method&lt;/b&gt; {String} (Optional) The HTTP method to use for the request. Defaults to the configured method, or
     * if no method was configured, &quot;GET&quot; if no parameters are being sent, and &quot;POST&quot; if parameters are being sent.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;callback&lt;/b&gt; {Function} (Optional) The function to be called upon receipt of the HTTP response.
     * The callback is called regardless of success or failure and is passed the following parameters:&lt;ul&gt;
     * &lt;li&gt;options {Object} The parameter to the request call.&lt;/li&gt;
     * &lt;li&gt;success {Boolean} True if the request succeeded.&lt;/li&gt;
     * &lt;li&gt;response {Object} The XMLHttpRequest object containing the response data.&lt;/li&gt;
     * &lt;/ul&gt;&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;success&lt;/b&gt; {Function} (Optional) The function to be called upon success of the request.
     * The callback is passed the following parameters:&lt;ul&gt;
     * &lt;li&gt;response {Object} The XMLHttpRequest object containing the response data.&lt;/li&gt;
     * &lt;li&gt;options {Object} The parameter to the request call.&lt;/li&gt;
     * &lt;/ul&gt;&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;failure&lt;/b&gt; {Function} (Optional) The function to be called upon failure of the request.
     * The callback is passed the following parameters:&lt;ul&gt;
     * &lt;li&gt;response {Object} The XMLHttpRequest object containing the response data.&lt;/li&gt;
     * &lt;li&gt;options {Object} The parameter to the request call.&lt;/li&gt;
     * &lt;/ul&gt;&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;scope&lt;/b&gt; {Object} (Optional) The scope in which to execute the callbacks: The &quot;this&quot; object
     * for the callback function. Defaults to the browser window.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;form&lt;/b&gt; {Object/String} (Optional) A form object or id to pull parameters from.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;isUpload&lt;/b&gt; {Boolean} (Optional) True if the form object is a file upload (will usually be automatically detected).&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;headers&lt;/b&gt; {Object} (Optional) Request headers to set for the request.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;xmlData&lt;/b&gt; {Object} (Optional) XML document to use for the post. Note: This will be used instead of
     * params for the post data. Any params will be appended to the URL.&lt;/li&gt;
     * &lt;li&gt;&lt;b&gt;disableCaching&lt;/b&gt; {Boolean} (Optional) True to add a unique cache-buster param to GET requests.&lt;/li&gt;
     * &lt;/ul&gt;
     * @return {Number} transactionId
     */
    </span><span class="jsdoc-var">request </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this.fireEvent</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">&quot;beforerequest&quot;</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">) !== </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">){
            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">o.params</span><span class="jsdoc-syntax">;

            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">typeof </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">&quot;function&quot;</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">p.call</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.scope</span><span class="jsdoc-syntax">||</span><span class="jsdoc-var">window</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">);
            }
            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">typeof </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">&quot;object&quot;</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.urlEncode</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.params</span><span class="jsdoc-syntax">);
            }
            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this.extraParams</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">extras </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.urlEncode</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this.extraParams</span><span class="jsdoc-syntax">);
                </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">? (</span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">+ </span><span class="jsdoc-string">'&amp;' </span><span class="jsdoc-syntax">+ </span><span class="jsdoc-var">extras</span><span class="jsdoc-syntax">) : </span><span class="jsdoc-var">extras</span><span class="jsdoc-syntax">;
            }

            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">o.url </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">this.url</span><span class="jsdoc-syntax">;
            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">typeof </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">'function'</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">url.call</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.scope</span><span class="jsdoc-syntax">||</span><span class="jsdoc-var">window</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">);
            }

            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.form</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">form </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.getDom</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.form</span><span class="jsdoc-syntax">);
                </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">form.action</span><span class="jsdoc-syntax">;

                </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">enctype </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">form.getAttribute</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">&quot;enctype&quot;</span><span class="jsdoc-syntax">);
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.isUpload </span><span class="jsdoc-syntax">|| (</span><span class="jsdoc-var">enctype </span><span class="jsdoc-syntax">&amp;&amp; </span><span class="jsdoc-var">enctype.toLowerCase</span><span class="jsdoc-syntax">() == </span><span class="jsdoc-string">'multipart/form-data'</span><span class="jsdoc-syntax">)){
                    </span><span class="jsdoc-keyword">return </span><span class="jsdoc-var">this.doFormUpload</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">p</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">url</span><span class="jsdoc-syntax">);
                }
                </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">f </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.lib.Ajax.serializeForm</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">form</span><span class="jsdoc-syntax">);
                </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">? (</span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">+ </span><span class="jsdoc-string">'&amp;' </span><span class="jsdoc-syntax">+ </span><span class="jsdoc-var">f</span><span class="jsdoc-syntax">) : </span><span class="jsdoc-var">f</span><span class="jsdoc-syntax">;
            }

            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">hs </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">o.headers</span><span class="jsdoc-syntax">;
            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this.defaultHeaders</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">hs </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.apply</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">hs </span><span class="jsdoc-syntax">|| {}, </span><span class="jsdoc-var">this.defaultHeaders</span><span class="jsdoc-syntax">);
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(!</span><span class="jsdoc-var">o.headers</span><span class="jsdoc-syntax">){
                    </span><span class="jsdoc-var">o.headers </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">hs</span><span class="jsdoc-syntax">;
                }
            }

            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">cb </span><span class="jsdoc-syntax">= {
                </span><span class="jsdoc-var">success</span><span class="jsdoc-syntax">: </span><span class="jsdoc-var">this.handleResponse</span><span class="jsdoc-syntax">,
                </span><span class="jsdoc-var">failure</span><span class="jsdoc-syntax">: </span><span class="jsdoc-var">this.handleFailure</span><span class="jsdoc-syntax">,
                </span><span class="jsdoc-var">scope</span><span class="jsdoc-syntax">: </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">,
                </span><span class="jsdoc-var">argument</span><span class="jsdoc-syntax">: {</span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">: </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">},
                </span><span class="jsdoc-var">timeout </span><span class="jsdoc-syntax">: </span><span class="jsdoc-var">o.timeout </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">this.timeout
            </span><span class="jsdoc-syntax">};

            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">method </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">o.method</span><span class="jsdoc-syntax">||</span><span class="jsdoc-var">this.method</span><span class="jsdoc-syntax">||(</span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">? </span><span class="jsdoc-string">&quot;POST&quot; </span><span class="jsdoc-syntax">: </span><span class="jsdoc-string">&quot;GET&quot;</span><span class="jsdoc-syntax">);

            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">method </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">'GET' </span><span class="jsdoc-syntax">&amp;&amp; (</span><span class="jsdoc-var">this.disableCaching </span><span class="jsdoc-syntax">&amp;&amp; </span><span class="jsdoc-var">o.disableCaching </span><span class="jsdoc-syntax">!== </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">) || </span><span class="jsdoc-var">o.disableCaching </span><span class="jsdoc-syntax">=== </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">+= (</span><span class="jsdoc-var">url.indexOf</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">'?'</span><span class="jsdoc-syntax">) != -1 ? </span><span class="jsdoc-string">'&amp;' </span><span class="jsdoc-syntax">: </span><span class="jsdoc-string">'?'</span><span class="jsdoc-syntax">) + </span><span class="jsdoc-string">'_dc=' </span><span class="jsdoc-syntax">+ (</span><span class="jsdoc-keyword">new </span><span class="jsdoc-var">Date</span><span class="jsdoc-syntax">()</span><span class="jsdoc-var">.getTime</span><span class="jsdoc-syntax">());
            }

            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">typeof </span><span class="jsdoc-var">o.autoAbort </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">'boolean'</span><span class="jsdoc-syntax">){ </span><span class="jsdoc-comment">// options gets top priority
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.autoAbort</span><span class="jsdoc-syntax">){
                    </span><span class="jsdoc-var">this.abort</span><span class="jsdoc-syntax">();
                }
            }</span><span class="jsdoc-keyword">else if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">this.autoAbort </span><span class="jsdoc-syntax">!== </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">this.abort</span><span class="jsdoc-syntax">();
            }

            </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">((</span><span class="jsdoc-var">method </span><span class="jsdoc-syntax">== </span><span class="jsdoc-string">'GET' </span><span class="jsdoc-syntax">&amp;&amp; </span><span class="jsdoc-var">p</span><span class="jsdoc-syntax">) || </span><span class="jsdoc-var">o.xmlData</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-var">url </span><span class="jsdoc-syntax">+= (</span><span class="jsdoc-var">url.indexOf</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">'?'</span><span class="jsdoc-syntax">) != -1 ? </span><span class="jsdoc-string">'&amp;' </span><span class="jsdoc-syntax">: </span><span class="jsdoc-string">'?'</span><span class="jsdoc-syntax">) + </span><span class="jsdoc-var">p</span><span class="jsdoc-syntax">;
                </span><span class="jsdoc-var">p </span><span class="jsdoc-syntax">= </span><span class="jsdoc-string">''</span><span class="jsdoc-syntax">;
            }
            </span><span class="jsdoc-var">this.transId </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.lib.Ajax.request</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">method</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">url</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">cb</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">p</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">);
            </span><span class="jsdoc-keyword">return </span><span class="jsdoc-var">this.transId</span><span class="jsdoc-syntax">;
        }</span><span class="jsdoc-keyword">else</span><span class="jsdoc-syntax">{
            </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.callback</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">null</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">null</span><span class="jsdoc-syntax">]);
            </span><span class="jsdoc-keyword">return null</span><span class="jsdoc-syntax">;
        }
    },

    </span><span class="jsdoc-comment">/**
     * Determine whether this object has a request outstanding.
     * @param {Number} transactionId (Optional) defaults to the last transaction
     * @return {Boolean} True if there is an outstanding request.
     */
    </span><span class="jsdoc-var">isLoading </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId</span><span class="jsdoc-syntax">){
            </span><span class="jsdoc-keyword">return </span><span class="jsdoc-var">Roo.lib.Ajax.isCallInProgress</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId</span><span class="jsdoc-syntax">);
        }</span><span class="jsdoc-keyword">else</span><span class="jsdoc-syntax">{
            </span><span class="jsdoc-keyword">return </span><span class="jsdoc-var">this.transId </span><span class="jsdoc-syntax">? </span><span class="jsdoc-keyword">true </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">;
        }
    },

    </span><span class="jsdoc-comment">/**
     * Aborts any outstanding request.
     * @param {Number} transactionId (Optional) defaults to the last transaction
     */
    </span><span class="jsdoc-var">abort </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">this.isLoading</span><span class="jsdoc-syntax">()){
            </span><span class="jsdoc-var">Roo.lib.Ajax.abort</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">transId </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">this.transId</span><span class="jsdoc-syntax">);
        }
    },

    </span><span class="jsdoc-comment">// private
    </span><span class="jsdoc-var">handleResponse </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-var">this.transId </span><span class="jsdoc-syntax">= </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">options </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">response.argument.options</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">response.argument </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">options </span><span class="jsdoc-syntax">? </span><span class="jsdoc-var">options.argument </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">null</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">this.fireEvent</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">&quot;requestcomplete&quot;</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">);
        </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">options.success</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">]);
        </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">options.callback</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">]);
    },

    </span><span class="jsdoc-comment">// private
    </span><span class="jsdoc-var">handleFailure </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">e</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-var">this.transId </span><span class="jsdoc-syntax">= </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">options </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">response.argument.options</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">response.argument </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">options </span><span class="jsdoc-syntax">? </span><span class="jsdoc-var">options.argument </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">null</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">this.fireEvent</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">&quot;requestexception&quot;</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">e</span><span class="jsdoc-syntax">);
        </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">options.failure</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">]);
        </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">options.callback</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">options.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">options</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">response</span><span class="jsdoc-syntax">]);
    },

    </span><span class="jsdoc-comment">// private
    </span><span class="jsdoc-var">doFormUpload </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">ps</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">url</span><span class="jsdoc-syntax">){
        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">id </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.id</span><span class="jsdoc-syntax">();
        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">frame </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">document.createElement</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">'iframe'</span><span class="jsdoc-syntax">);
        </span><span class="jsdoc-var">frame.id </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">frame.name </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">frame.className </span><span class="jsdoc-syntax">= </span><span class="jsdoc-string">'x-hidden'</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">Roo.isIE</span><span class="jsdoc-syntax">){
            </span><span class="jsdoc-var">frame.src </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.SSL_SECURE_URL</span><span class="jsdoc-syntax">;
        }
        </span><span class="jsdoc-var">document.body.appendChild</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">frame</span><span class="jsdoc-syntax">);

        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">Roo.isIE</span><span class="jsdoc-syntax">){
           </span><span class="jsdoc-var">document.frames</span><span class="jsdoc-syntax">[</span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">]</span><span class="jsdoc-var">.name </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">;
        }

        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">form </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.getDom</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.form</span><span class="jsdoc-syntax">);
        </span><span class="jsdoc-var">form.target </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">form.method </span><span class="jsdoc-syntax">= </span><span class="jsdoc-string">'POST'</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-var">form.enctype </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">form.encoding </span><span class="jsdoc-syntax">= </span><span class="jsdoc-string">'multipart/form-data'</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">url</span><span class="jsdoc-syntax">){
            </span><span class="jsdoc-var">form.action </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">url</span><span class="jsdoc-syntax">;
        }

        </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">hiddens</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">hd</span><span class="jsdoc-syntax">;
        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">ps</span><span class="jsdoc-syntax">){ </span><span class="jsdoc-comment">// add dynamic params
            </span><span class="jsdoc-var">hiddens </span><span class="jsdoc-syntax">= [];
            </span><span class="jsdoc-var">ps </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">Roo.urlDecode</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">ps</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">false</span><span class="jsdoc-syntax">);
            </span><span class="jsdoc-keyword">for</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">k </span><span class="jsdoc-keyword">in </span><span class="jsdoc-var">ps</span><span class="jsdoc-syntax">){
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">ps.hasOwnProperty</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">k</span><span class="jsdoc-syntax">)){
                    </span><span class="jsdoc-var">hd </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">document.createElement</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">'input'</span><span class="jsdoc-syntax">);
                    </span><span class="jsdoc-var">hd.type </span><span class="jsdoc-syntax">= </span><span class="jsdoc-string">'hidden'</span><span class="jsdoc-syntax">;
                    </span><span class="jsdoc-var">hd.name </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">k</span><span class="jsdoc-syntax">;
                    </span><span class="jsdoc-var">hd.value </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">ps</span><span class="jsdoc-syntax">[</span><span class="jsdoc-var">k</span><span class="jsdoc-syntax">];
                    </span><span class="jsdoc-var">form.appendChild</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">hd</span><span class="jsdoc-syntax">);
                    </span><span class="jsdoc-var">hiddens.push</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">hd</span><span class="jsdoc-syntax">);
                }
            }
        }

        </span><span class="jsdoc-keyword">function </span><span class="jsdoc-var">cb</span><span class="jsdoc-syntax">(){
            </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">r </span><span class="jsdoc-syntax">= {  </span><span class="jsdoc-comment">// bogus response object
                </span><span class="jsdoc-var">responseText </span><span class="jsdoc-syntax">: </span><span class="jsdoc-string">''</span><span class="jsdoc-syntax">,
                </span><span class="jsdoc-var">responseXML </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">null
            </span><span class="jsdoc-syntax">};

            </span><span class="jsdoc-var">r.argument </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">o </span><span class="jsdoc-syntax">? </span><span class="jsdoc-var">o.argument </span><span class="jsdoc-syntax">: </span><span class="jsdoc-keyword">null</span><span class="jsdoc-syntax">;

            </span><span class="jsdoc-keyword">try </span><span class="jsdoc-syntax">{ </span><span class="jsdoc-comment">//
                </span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">doc</span><span class="jsdoc-syntax">;
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">Roo.isIE</span><span class="jsdoc-syntax">){
                    </span><span class="jsdoc-var">doc </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">frame.contentWindow.document</span><span class="jsdoc-syntax">;
                }</span><span class="jsdoc-keyword">else </span><span class="jsdoc-syntax">{
                    </span><span class="jsdoc-var">doc </span><span class="jsdoc-syntax">= (</span><span class="jsdoc-var">frame.contentDocument </span><span class="jsdoc-syntax">|| </span><span class="jsdoc-var">window.frames</span><span class="jsdoc-syntax">[</span><span class="jsdoc-var">id</span><span class="jsdoc-syntax">]</span><span class="jsdoc-var">.document</span><span class="jsdoc-syntax">);
                }
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">doc </span><span class="jsdoc-syntax">&amp;&amp; </span><span class="jsdoc-var">doc.body</span><span class="jsdoc-syntax">){
                    </span><span class="jsdoc-var">r.responseText </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">doc.body.innerHTML</span><span class="jsdoc-syntax">;
                }
                </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">doc </span><span class="jsdoc-syntax">&amp;&amp; </span><span class="jsdoc-var">doc.XMLDocument</span><span class="jsdoc-syntax">){
                    </span><span class="jsdoc-var">r.responseXML </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">doc.XMLDocument</span><span class="jsdoc-syntax">;
                }</span><span class="jsdoc-keyword">else </span><span class="jsdoc-syntax">{
                    </span><span class="jsdoc-var">r.responseXML </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">doc</span><span class="jsdoc-syntax">;
                }
            }
            </span><span class="jsdoc-keyword">catch</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">e</span><span class="jsdoc-syntax">) {
                </span><span class="jsdoc-comment">// ignore
            </span><span class="jsdoc-syntax">}

            </span><span class="jsdoc-var">Roo.EventManager.removeListener</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">frame</span><span class="jsdoc-syntax">, </span><span class="jsdoc-string">'load'</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">cb</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">);

            </span><span class="jsdoc-var">this.fireEvent</span><span class="jsdoc-syntax">(</span><span class="jsdoc-string">&quot;requestcomplete&quot;</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">r</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">);
            </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.success</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">r</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">]);
            </span><span class="jsdoc-var">Roo.callback</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">o.callback</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">o.scope</span><span class="jsdoc-syntax">, [</span><span class="jsdoc-var">o</span><span class="jsdoc-syntax">, </span><span class="jsdoc-keyword">true</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">r</span><span class="jsdoc-syntax">]);

            </span><span class="jsdoc-var">setTimeout</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">function</span><span class="jsdoc-syntax">(){</span><span class="jsdoc-var">document.body.removeChild</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">frame</span><span class="jsdoc-syntax">);}, 100);
        }

        </span><span class="jsdoc-var">Roo.EventManager.on</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">frame</span><span class="jsdoc-syntax">, </span><span class="jsdoc-string">'load'</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">cb</span><span class="jsdoc-syntax">, </span><span class="jsdoc-var">this</span><span class="jsdoc-syntax">);
        </span><span class="jsdoc-var">form.submit</span><span class="jsdoc-syntax">();

        </span><span class="jsdoc-keyword">if</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">hiddens</span><span class="jsdoc-syntax">){ </span><span class="jsdoc-comment">// remove dynamic params
            </span><span class="jsdoc-keyword">for</span><span class="jsdoc-syntax">(</span><span class="jsdoc-keyword">var </span><span class="jsdoc-var">i </span><span class="jsdoc-syntax">= 0, </span><span class="jsdoc-var">len </span><span class="jsdoc-syntax">= </span><span class="jsdoc-var">hiddens.length</span><span class="jsdoc-syntax">; </span><span class="jsdoc-var">i </span><span class="jsdoc-syntax">&lt; </span><span class="jsdoc-var">len</span><span class="jsdoc-syntax">; </span><span class="jsdoc-var">i</span><span class="jsdoc-syntax">++){
                </span><span class="jsdoc-var">form.removeChild</span><span class="jsdoc-syntax">(</span><span class="jsdoc-var">hiddens</span><span class="jsdoc-syntax">[</span><span class="jsdoc-var">i</span><span class="jsdoc-syntax">]);
            }
        }
    }
});
</span></code></body></html>